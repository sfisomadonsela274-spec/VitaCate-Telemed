#:import App kivy.app.App

<PatientHomeScreen>:
    name: 'patient_home'
    
    # Background
    FloatLayout:
        canvas.before:
            Color:
                rgba: 0.95, 0.95, 0.98, 1
            Rectangle:
                pos: self.pos
                size: self.size

    BoxLayout:
        orientation: 'vertical'
        padding: dp(20)
        spacing: dp(20)

        # Header Section
        BoxLayout:
            orientation: 'vertical'
            size_hint_y: 0.2
            spacing: dp(10)
            padding: [dp(10), dp(5), dp(10), dp(5)]

            # Welcome Header with Icons
            BoxLayout:
                orientation: 'horizontal'
                size_hint_y: 0.5
                padding: [dp(5), 0, dp(5), 0]
                
                MDIconButton:
                    icon: "home"
                    theme_text_color: "Custom"
                    text_color: 0.1, 0.5, 0.8, 1
                    pos_hint: {"x": 0, "center_y": 0.5}
                    on_release: root.show_home_confirmation()

                MDIconButton:
                    icon: "logout"
                    theme_text_color: "Custom"
                    text_color: 0.8, 0.2, 0.2, 1
                    pos_hint: {"right": 0, "center_y": 0.5}
                    on_release: root.show_logout_confirmation()


            BoxLayout:
                orientation: 'vertical'
                size_hint_y: 0.5
                spacing: dp(5)
                padding: [0, dp(5), 0, 0]
                
                MDLabel:
                    id: welcome_label
                    text: "Welcome, Patient!"
                    theme_text_color: "Custom"
                    text_color: 0.1, 0.3, 0.6, 1
                    font_style: "H4"
                    bold: True
                    halign: "center"
                    size_hint_y: 0.6
                    valign: 'bottom'
                    padding: [0, 0, 0, dp(5)]

                MDLabel:
                    text: "Your Healthcare Dashboard"
                    theme_text_color: "Secondary"
                    halign: "center"
                    font_style: "Body2"
                    size_hint_y: 0.4
                    valign: 'top'

        # Main Content Cards
        ScrollView:
            do_scroll_x: False
            do_scroll_y: True
            bar_width: dp(4)
            bar_color: 0.1, 0.5, 0.8, 0.3
            bar_inactive_color: 0.1, 0.5, 0.8, 0.1
            effect_cls: "ScrollEffect"

            BoxLayout:
                orientation: 'vertical'
                size_hint_y: None
                height: self.minimum_height
                spacing: dp(15)
                padding: [dp(5), dp(10), dp(5), dp(10)]

                # Latest Appointment Card
                MDCard:
                    orientation: 'vertical'
                    size_hint: None, None
                    size: dp(400), dp(160)
                    pos_hint: {"center_x": 0.5}
                    elevation: 2
                    padding: [dp(15), dp(10), dp(15), dp(15)]
                    spacing: dp(10)
                    md_bg_color: 1, 1, 1, 1
                    radius: [dp(12),]

                    MDLabel:
                        text: "Latest Appointment"
                        theme_text_color: "Custom"
                        text_color: 0.1, 0.3, 0.6, 1
                        font_style: "H5"
                        bold: True
                        halign: "center"
                        size_hint_y: None
                        height: self.texture_size[1]

                    MDLabel:
                        id: appointment_label
                        text: "Loading appointments..."
                        theme_text_color: "Secondary"
                        halign: "center"
                        font_style: "Body1"
                        size_hint_y: None
                        height: self.texture_size[1]

                    MDRaisedButton:
                        text: "Refresh"
                        md_bg_color: 0.1, 0.5, 0.8, 1
                        theme_text_color: "Custom"
                        text_color: 1, 1, 1, 1
                        size_hint_y: None
                        height: dp(40)
                        font_style: "Button"
                        elevation: 0
                        pos_hint: {"center_x": 0.5}
                        on_release: root.load_appointment()

                # Quick Actions Card
                MDCard:
                    orientation: 'vertical'
                    size_hint: None, None
                    size: dp(400), dp(240)
                    pos_hint: {"center_x": 0.5}
                    elevation: 2
                    padding: [dp(15), dp(10), dp(15), dp(15)]
                    spacing: dp(10)
                    md_bg_color: 1, 1, 1, 1
                    radius: [dp(12),]

                    MDLabel:
                        text: "Quick Actions"
                        theme_text_color: "Custom"
                        text_color: 0.1, 0.3, 0.6, 1
                        font_style: "H5"
                        bold: True
                        halign: "center"
                        size_hint_y: None
                        height: self.texture_size[1]

                    GridLayout:
                        cols: 2
                        spacing: dp(10), dp(12)
                        padding: [0, dp(5), 0, 0]
                        size_hint_y: None
                        height: self.minimum_height
                        row_default_height: dp(45)
                        row_force_default: True

                        MDRaisedButton:
                            text: "Book New Appointment"
                            md_bg_color: 0.1, 0.5, 0.8, 1
                            theme_text_color: "Custom"
                            text_color: 1, 1, 1, 1
                            font_style: "Button"
                            elevation: 0
                            on_release: root.manager.current = 'book_appointment'

                        MDRaisedButton:
                            text: "View Prescriptions"
                            md_bg_color: 0.2, 0.6, 0.9, 1
                            theme_text_color: "Custom"
                            text_color: 1, 1, 1, 1
                            font_style: "Button"
                            elevation: 0
                            on_release: root.manager.current = 'patient_prescriptions'

                        MDRaisedButton:
                            text: "View Consultations"
                            md_bg_color: 0.3, 0.7, 1.0, 1
                            theme_text_color: "Custom"
                            text_color: 1, 1, 1, 1
                            font_style: "Button"
                            elevation: 0
                            on_release: root.manager.current = 'patient_consultations'

                        MDRaisedButton:
                            text: "Chat with Doctor"
                            md_bg_color: 0.6, 0.2, 0.8, 1
                            theme_text_color: "Custom"
                            text_color: 1, 1, 1, 1
                            font_style: "Button"
                            elevation: 0
                            on_release: root.start_chat()

                        Widget:

                        MDRaisedButton:
                            text: "Start Video Call"
                            md_bg_color: 0.1, 0.8, 0.4, 1
                            theme_text_color: "Custom"
                            text_color: 1, 1, 1, 1
                            font_style: "Button"
                            elevation: 0
                            on_release: root.start_video_call()

                # Health Tips Card
                MDCard:
                    orientation: 'vertical'
                    size_hint: None, None
                    size: dp(400), dp(140)
                    pos_hint: {"center_x": 0.5}
                    elevation: 2
                    padding: [dp(15), dp(10), dp(15), dp(15)]
                    spacing: dp(8)
                    md_bg_color: 1, 1, 1, 1
                    radius: [dp(12),]

                    MDLabel:
                        text: "Health Tip"
                        theme_text_color: "Custom"
                        text_color: 0.1, 0.3, 0.6, 1
                        font_style: "H6"
                        bold: True
                        halign: "center"
                        size_hint_y: None
                        height: self.texture_size[1]

                    MDLabel:
                        text: "Remember to take your medications on time and stay hydrated!"
                        theme_text_color: "Secondary"
                        halign: "center"
                        font_style: "Body2"
                        size_hint_y: None
                        height: self.texture_size[1]

        # Footer
        BoxLayout:
            orientation: 'vertical'
            size_hint_y: 0.15
            spacing: dp(5)

            MDLabel:
                text: "VitaCare Patient Portal"
                theme_text_color: "Secondary"
                font_style: "Caption"
                halign: "center"

            MDLabel:
                text: "Your Health, Our Priority"
                theme_text_color: "Secondary"
                font_style: "Overline"
                halign: "center"